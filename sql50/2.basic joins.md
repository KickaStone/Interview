# 1378. Replace Employee ID With The Unique Identifier

```sql
select EmployeeUNI.unique_id, Employees.name from Employees left join EmployeeUNI on Employees.id = EmployeeUNI.id;
```

# 1068. Product Sales Analysis I

```sql
select product_name, year, price from Sales join Product on Sales.product_id = Product.product_id;
```


# 1581. Customer Who Visited but Did Not Make Any Transactions

```sql
select 
    customer_id, count(*) count_no_trans 
from 
    Visits a left join Transactions b on a.visit_id = b.visit_id
where 
    b.visit_id is null
group by
    customer_id
```

# 197. Rising Temperature

```sql
select A.id from Weather A join Weather B 
on DATEDIFF(A.recordDate, B.recordDate) = 1
where A.temperature > B.temperature;
-- 
SELECT w1.id FROM Weather  w1 INNER JOIN Weather w2 
ON w1.recordDate = w2.recordDate + INTERVAL 1 DAY AND w1.temperature  > w2.temperature 
```
注意where条件限制, `DATEDIFF`的使用


#  1661. Average Time of Process per Machine

思路1 Self-Join:

```sql
SELECT 
    a1.machine_id,
    ROUND(AVG(a2.timestamp - a1.timestamp), 3) AS processing_time
FROM Activity a1
JOIN Activity a2 
    ON a1.machine_id = a2.machine_id 
    AND a1.process_id = a2.process_id
    AND a1.activity_type = 'start' 
    AND a2.activity_type = 'end'
GROUP BY a1.machine_id;
```

1. 把同一个任务的开始时间和结束时间join到同一条记录里
2. join条件要包括type，machine_id和process_id
3. 用group by和avg计算平均时间，用round取有效小数位

思路2 Using Subqueries

```sql
SELECT 
    machine_id,
    ROUND(
        (SELECT AVG(timestamp) FROM Activity WHERE activity_type = 'end' AND machine_id = a.machine_id) -
        (SELECT AVG(timestamp) FROM Activity WHERE activity_type = 'start' AND machine_id = a.machine_id),
        3
    ) AS processing_time
FROM Activity a
GROUP BY machine_id;
```


# 577. Employee Bonus

```sql
select name, bonus from Employee left join Bonus on Employee.empId = Bonus.empId
where bonus is null or bonus < 1000;
```


# 1280. Students and Examinations

```sql
select 
    a.student_id,
    a.student_name,
    b.subject_name,
    count(c.subject_name) as attended_exams
from Students a
cross join Subjects b
left join Examinations c
on a.student_id = c.student_id and c.subject_name = b.subject_name
group by a.student_id, b.subject_name
order by a.student_id, b.subject_name
```


# 570. Managers with at Least 5 Direct Reports

```sql
select 
    b.name
from
    Employee a
join Employee b
on a.managerId = b.id
group by b.id
having count(a.managerId) >= 5
```
不要用b.name进行group，因为不是主键


# 1934. Confirmation Rate
```sql
select 
    a.user_id,
    if(count(b.user_id) = 0, 0, round((count(if(b.action="confirmed", 1, null)))/(count(b.user_id)) ,2)) as confirmation_rate 
from Signups a
left join Confirmations b
on a.user_id = b.user_id
group by a.user_id 
```